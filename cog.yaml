build:
  gpu: true
  python_version: "3.11"

  # Let Cog handle the requirements file as intended.
  # This will be executed AFTER the 'run' block below.
  python_requirements: "requirements.txt"

  system_packages:
    - "build-essential"
    - "cmake"
    - "ninja-build"
    - "git"
    - "python3-dev"
    - "ffmpeg"

  # This 'run' block is executed BEFORE 'python_requirements' is processed.
  run:
    # Step 1: Upgrade pip and pre-install the build-time dependency for flash-attn.
    # This command does not need any project files and will succeed.
    - "pip install --upgrade pip packaging"

    # Step 2: Download the model weights.
    - "huggingface-cli download Wan-AI/Wan2.2-S-2-V-14-B --local-dir ./Wan-2.2-S-2-V-14-B"

predict: "predict.py:Predictor"
