build:
  gpu: true
  python_version: "3.11"
  system_packages:
    - "build-essential"
    - "cmake"
    - "ninja-build"
    - "git"
    - "python3-dev"
    - "ffmpeg"

  # Step 1: Pre-install the build-time dependencies.
  # This 'run' block executes BEFORE 'python_requirements'.
  run:
    - "pip install --upgrade pip setuptools wheel packaging"

  # Step 2: Let Cog automatically install everything from your requirements file.
  # This now succeeds because 'packaging' is already installed.
  python_requirements: "requirements.txt"

# Step 3: This separate 'run' block executes AFTER everything is installed.
# It's the perfect place to download model weights.
run:
  - "huggingface-cli download Wan-AI/Wan2.2-S2V-14B --local-dir ./Wan2.2-S2V-14B"

predict: "predict.py:Predictor"
